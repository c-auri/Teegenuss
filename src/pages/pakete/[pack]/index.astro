---
import Page from '../../../layouts/Page.astro'
import Frame from '../../../components/page/Frame.astro'
import Preview from '../../../components/tea/Preview.astro'

import { getCollection } from 'astro:content'
import { modulo } from '../../../scripts/modulo'

export async function getStaticPaths() {
    const packs = await getCollection('packs')

    return packs.map(pack => ({
        params: { pack: pack.data.route },
        props: { entry: pack }
    }))
}

const { entry } = Astro.props
const packs = await getCollection('packs')
const teas = await getCollection('teas', tea => tea.data.pack.id === entry.id)
const bg = "bg-white"

const packIndex = packs.findIndex(pack => pack.id === entry.id)
const prevPack = packs[modulo(packIndex - 1, packs.length)]!
const nextPack = packs[modulo(packIndex + 1, packs.length)]!

const absolute = [{
    name: entry.data.title, href: `/pakete/${entry.data.route}`
}]

const relative = {
    prevHref: `/pakete/${prevPack.data.route}`,
    nextHref: `/pakete/${nextPack.data.route}`,
}
---
<Page title={entry.data.title} absolute={absolute} relative={relative}>
    <Frame bg={bg}>
        <div class="mb-36 w-full flex flex-col items-center">
            <h1 class="my-5 text-4xl font-bold">{entry.data.title}</h1>
            <p class="my-12 text-xl max-w-3xl lg:max-w-4xl">{entry.data.teaser}</p>
            <div class="my-16 w-full flex justify-center">
                <div class="w-full max-w-5xl flex gap-14 flex-wrap justify-center">
                    {
                        teas.map(tea => (
                            <li class="list-none">
                                <Preview tea={tea} images={[
                                    { src: `/images/teas/${tea.slug}/01.png` },
                                    { src: `/images/teas/${tea.slug}/02.png` }
                                ]} />
                            </li>))
                    }
                </div>
            </div>
        </div>
    </Frame>
</Page>